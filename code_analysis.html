<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <title>Secure Coding Analysis - SecureNexus</title>
    <link rel="stylesheet" href="/static/style.css" />
    <script>
        async function analyzeCode() {
            const code = document.getElementById('inputCode').value.trim();
            if (!code) {
                alert('Please paste your code before submitting.');
                return;
            }
            setResult('Analyzing...');
            try {
                const response = await fetch('/api/analyze', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ code })
                });
                const data = await response.json();
                if (data.error) {
                    setResultError(data.error);
                } else {
                    setResult(formatResult(data.result));
                }
            } catch (e) {
                setResultError(e.message);
            }
        }

        function setResult(html) {
            document.getElementById('resultArea').innerHTML = html;
        }

        function setResultError(message) {
            setResult(`<p class="error">Error: ${escapeHtml(message)}</p>`);
        }

        function formatResult(text) {
            return `<h2>Analysis Result</h2><pre>${escapeHtml(text)}</pre>`;
        }

        function escapeHtml(text) {
            return text.replace(/[&<>"']/g, m =>
                ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' })[m]
            );
        }
    </script>
</head>

<body>
    <div class="container">
        <h1>Secure Coding Analysis</h1>

        <textarea id="inputCode" placeholder="Paste your code here..." rows="12"></textarea>

        <button class="btn" id="submitBtn" onclick="analyzeCode()">Analyze Code</button>

        <div id="resultArea" class="result-box"></div>

        <a href="/" class="back-link">‚Üê Back to Home</a>
    </div>
</body>

</html>